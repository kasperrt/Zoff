!function(){function e(){s.on("np",l.youtube_listener)}function t(){s.on("channel",d.channel_function)}function a(e){$("#volume").slider("value",e),c.setVolume(e)}var l={loaded:!0,before_load:"",after_load:"",player:"",stopInterval:!1,youtube_listener:function(e){l.loaded=!1,n.log("--------youtube_listener--------"),n.log("Received: "),n.log(e),n.log("paused variable: "+h),n.log("mobile_beginning variable: "+k);try{n.log("getVideoUrl(): "+l.player.getVideoUrl().split("v=")[1])}catch(e){}if(n.log("video_id variable: "+o),n.log("---------------------------------"),e.np){if(h)l.getTitle(e.np[0].title,viewers),n.mobilecheck()||l.notifyUser(e.np[0].id,e.np[0].title),S||l.stopVideo(),o=e.np[0].id,conf=e.conf[0],time=e.time,i=time-conf.startTime,u=e.np[0].title,duration=e.np[0].duration;else if(!h){void 0===p?p=e.np[0].id:p!=o&&(p=o),o=e.np[0].id,conf=e.conf[0],time=e.time,i=time-conf.startTime,u=e.np[0].title,duration=e.np[0].duration,k&&n.mobilecheck()&&0===i&&!S&&(i=1);try{full_playlist[0].id==o&&d.song_change(full_playlist[0].added),Suggestions.fetchYoutubeSuggests(o)}catch(e){}if(l.getTitle(u,viewers),l.setBGimage(o),m&&!window.MSStream)try{(l.player.getVideoUrl().split("v=")[1]!=o||S)&&(l.loadVideoById(o),n.mobilecheck()||l.notifyUser(o,u),l.seekTo(i),h&&!S&&l.pauseVideo()),h||(k&&!S||l.playVideo(),x||l.durationSetter()),(l.player.getDuration()>i||0===l.player.getDuration()||S||l.player.getCurrentTime()!=i)&&l.seekTo(i),l.after_load=o,l.loaded||setTimeout(function(){l.loaded=!0},500)}catch(e){S&&(l.loadVideoById(o),l.seekTo(i)),x||S||l.durationSetter()}else l.getTitle(u,viewers)}}else{document.getElementById("song-title").innerHTML="Empty channel. Add some songs!",$("#player_overlay").height($("#player").height()),window.MSStream||S||$("#player_overlay").toggleClass("hide");try{S||l.stopVideo()}catch(e){}}},onPlayerStateChange:function(e){n.log("-------onPlayerStateChange------"),n.log("New state\nState: "),n.log(e);try{n.log("Duration: "+l.player.getDuration(),"Current time: "+l.player.getCurrentTime()),n.log("getVideoUrl(): "+l.player.getVideoUrl().split("v=")[1])}catch(e){}switch(n.log("video_id variable: "+o),n.log("---------------------------------"),e.data){case-1:break;case 0:playing=!1,h=!1,s.emit("end",{id:o,channel:I.toLowerCase()});break;case 1:playing=!0,beginning&&n.mobilecheck()&&!S&&(l.pauseVideo(),beginning=!1,k=!1,setTimeout(function(){n.mobilecheck()&&($("#playpause").css("visibility","visible"),$("#playpause").css("pointer-events","all"))},100)),_||"/"==window.location.pathname||S||n.addClass("#player_overlay","hide"),"/"!=window.location.pathname&&(1==document.getElementById("play").className.split(" ").length&&$("#play").toggleClass("hide"),2==document.getElementById("pause").className.split(" ").length&&$("#pause").toggleClass("hide")),h&&(s.emit("pos",{channel:I.toLowerCase()}),h=!1);break;case 2:S||(h=!0,"/"!=window.location.pathname&&c.play_pause_show(),k=!0);break;case 3:}},playVideo:function(){S?(castSession.sendMessage("urn:x-cast:zoff.no",{type:"playVideo"}),$("#pause").hasClass("hide")&&($("#play").toggleClass("hide"),$("#pause").toggleClass("hide"))):l.player.playVideo()},pauseVideo:function(){S?(castSession.sendMessage("urn:x-cast:zoff.no",{type:"pauseVideo"}),$("#play").hasClass("hide")&&($("#play").toggleClass("hide"),$("#pause").toggleClass("hide"))):l.player.pauseVideo()},seekTo:function(e){S?castSession.sendMessage("urn:x-cast:zoff.no",{type:"seekTo",seekTo:e}):l.player.seekTo(e)},loadVideoById:function(e){S?castSession.sendMessage("urn:x-cast:zoff.no",{type:"loadVideo",videoId:e}):l.player.loadVideoById(e)},stopVideo:function(){S?castSession.sendMessage("urn:x-cast:zoff.no",{type:"stopVideo"}):l.player.stopVideo()},setVolume:function(e){S?castSession.setVolume(e/100):l.player.setVolume(e)},sendNext:function(e){S&&castSession.sendMessage("urn:x-cast:zoff.no",{type:"nextVideo",title:e.title,videoId:e.videoId})},getTitle:function(e,t){var a=t>1?"viewers":"viewer",l=decodeURIComponent(e);if("/"!=window.location.pathname){var n=document.getElementById("song-title"),i=document.getElementById("viewers");n.innerHTML=l,i.innerHTML=t+" "+a,n.title=l,S&&($("#player_overlay").css("background","url(https://img.youtube.com/vi/"+o+"/hqdefault.jpg)"),$("#player_overlay").css("background-position","center"),$("#player_overlay").css("background-size","100%"),$("#player_overlay").css("background-color","black"),$("#player_overlay").css("background-repeat","no-repeat"),$("#player_overlay").css("height","calc(100% - 32px)"))}document.title=l+" • Zöff / "+I},errorHandler:function(e){5==e.data||100==e.data||101==e.data||150==e.data?(curr_playing=l.player.getVideoUrl().replace("https://www.youtube.com/watch?v=",""),s.emit("skip",{error:e.data,id:o,pass:C,channel:I.toLowerCase})):void 0!==o&&l.loadVideoById(o)},onPlayerReady:function(e){$("#channel-load").css("display","none");try{beginning=!0,m=!0,window.MSStream||(n.mobilecheck()&&!/iPad|iPhone|iPod/.test(navigator.userAgent)&&($("#playpause").css("visibility","hidden"),$("#playpause").css("pointer-events","none")),$("#player").css("opacity","1"),$("#controls").css("opacity","1"),$(".playlist").css("opacity","1"),l.loadVideoById(o),!B||n.mobilecheck()&&!S||l.playVideo(),x||l.durationSetter(),_?setTimeout(function(){l.player.seekTo(i),B||(l.player.pauseVideo(),c.play_pause_show())},1e3):l.seekTo(i)),l.readyLooks(),c.initYoutubeControls(l.player),c.initSlider(),l.player.setVolume(Crypt.get_volume()),$(".video-container").removeClass("no-opacity")}catch(e){}},readyLooks:function(){l.setBGimage(o)},setBGimage:function(e){if(void 0!==e&&!_){var t=new Image;t.onload=function(){var e=new ColorThief,a=e.getColor(t);"/"!=window.location.pathname&&(document.getElementsByTagName("body")[0].style.backgroundColor=n.rgbToHsl(a,!0),$("meta[name=theme-color]").attr("content",n.rgbToHex(a[0],a[1],a[2])))},t.crossOrigin="Anonymous",t.src="https://zoff.no:8081/https://img.youtube.com/vi/"+e+"/mqdefault.jpg"}},set_width:function(e){$(".video-container").width(e)},notifyUser:function(e,t){if(t=t.replace(/\\\'/g,"'").replace(/&quot;/g,"'").replace(/&amp;/g,"&"),"granted"===Notification.permission&&document.hidden){var a=new Notification("Now Playing",{body:t,icon:"https://i.ytimg.com/vi/"+e+"/mqdefault.jpg",iconUrl:"http://i.ytimg.com/vi/"+e+"/mqdefault.jpg"});a.onclick=function(e){window.focus(),this.cancel()},setTimeout(function(){a.close()},5e3)}},setup_all_listeners:function(){get_list_listener(),e(),setup_admin_listener(),setup_chat_listener(),t()},onYouTubeIframeAPIReady:function(){l.player=new YT.Player("player",{videoId:o,playerVars:{rel:"0",wmode:"transparent",controls:"0",fs:"0",iv_load_policy:"3",theme:"light",color:"white",showinfo:0},events:{onReady:l.onPlayerReady,onStateChange:l.onPlayerStateChange,onError:l.errorHandler}})},durationSetter:function(){if(void 0!==duration)try{l.stopInterval||(x=!0),dMinutes=Math.floor(duration/60),dSeconds=duration-60*dMinutes,currDurr=void 0!==l.player.getCurrentTime()?Math.floor(l.player.getCurrentTime()):i,currDurr>duration&&(currDurr=duration),minutes=Math.floor(currDurr/60),seconds=currDurr-60*minutes,document.getElementById("duration").innerHTML=n.pad(minutes)+":"+n.pad(seconds)+" <span id='dash'>/</span> "+n.pad(dMinutes)+":"+n.pad(dSeconds),per=100/duration*currDurr,per>=100?per=100:0===duration&&(per=0),$("#bar").width(per+"%")}catch(e){}l.stopInterval||setTimeout(l.durationSetter,1e3)},loadPlayer:function(){if(1==$("script[src='https://www.youtube.com/iframe_api']").length)try{l.onYouTubeIframeAPIReady()}catch(e){console.error("Seems YouTube iFrame script isn't correctly loaded. Please reload the page.")}else tag=document.createElement("script"),tag.src="https://www.youtube.com/iframe_api",firstScriptTag=document.getElementsByTagName("script")[0],firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}},n={log:function(e){"true"===localStorage.debug&&console.log(e)},rnd:function(e){return e[Math.floor(Math.random()*e.length)]},mobilecheck:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},predicate:function(){for(var e,t,a,l=[],n=arguments.length,i=function(e,t){return e===t?0:e<t?-1:1},s=function(e,t){var a=i,l=i;return e&&(l=function(t,l){return a(e(t),e(l))}),t?function(e,t){return-1*l(e,t)}:l},o=0;o<n;o++)e=arguments[o],"string"==typeof e?(t=e,a=i):(t=e.name,a=s(e.primer,e.reverse)),l.push({name:t,cmp:a});return function(t,a){for(var i,s,o=0;o<n&&(s=0,e=l[o],i=e.name,s=e.cmp(t[i],a[i]),0===s);o++);return s}},hashCode:function(e){for(var t=0,a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);return t},intToARGB:function(e){return(e>>24&255).toString(16)+(e>>16&255).toString(16)+(e>>8&255).toString(16)+(255&e).toString(16)},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},pad:function(e){return e<10?"0"+Math.floor(e):Math.floor(e)},contains:function(e,t){for(var a=e.length;a--;)if(e[a]===t)return!0;return!1},sample:function(){Date.now()-lastSample>=2*SAMPLE_RATE&&(s.removeAllListeners(),s.disconnect(),s.connect(),l.setup_all_listeners()),lastSample=Date.now(),setTimeout(n.sample,SAMPLE_RATE)},loadjsfile:function(e){if(filesadded.indexOf("["+e+"]")==-1){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t),filesadded+="["+e+"]"}},msieversion:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return!!(t>0||navigator.userAgent.match(/Trident.*rv\:11\./))},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e))+e},rgbToHsl:function(e,t){r=e[0],g=e[1],b=e[2],r/=255,g/=255,b/=255;var a,l,n=Math.max(r,g,b),i=Math.min(r,g,b),s=(n+i)/2;if(n==i)a=l=0;else{var o=n-i;switch(l=s>.5?o/(2-n-i):o/(n+i),n){case r:a=(g-b)/o+(g<b?6:0);break;case g:a=(b-r)/o+2;break;case b:a=(r-g)/o+4}a/=6}return s>.5&&t?s=.5:s<.65&&!t&&(s=.65),"hsl("+Math.floor(360*a)+", "+Math.floor(100*l)+"%, "+Math.floor(100*s)+"%)"},componentToHex:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},rgbToHex:function(e,t,a){return"#"+n.componentToHex(e)+n.componentToHex(t)+n.componentToHex(a)},upperFirst:function(e){return e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()},addClass:function(e,t){n.contains($(e).attr("class").split(" "),t)||$(e).addClass(t)},send_mail:function(e,t){""!==e&&""!==t&&($("#submit-contact-form").addClass("hide"),$("#send-loader").removeClass("hide"),$("#contact-form-from").attr("disabled","true"),$("#contact-form-message").attr("disabled","true"),$.ajax({type:"POST",data:{from:e,message:t},url:"/public/php/mail.php",success:function(e){"success"==e?($("#contact-container").empty(),$("#contact-container").html("Mail has been sent, we'll be back with you shortly.")):($("#contact-container").empty(),$("#contact-container").html("Something went wrong, sorry about that. You could instead try with your own mail-client: <a title='Open in client' href='mailto:contact@zoff.no?Subject=Contact%20Zoff'>contact@zoff.no</a>"))}}))}};$(document).on("submit","#contact-form",function(e){e.preventDefault();var t=$("#contact-form-message").val(),a=$("#contact-form-from").val();n.send_mail(a,t)}),Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=0,t=this.length;e<t;e++)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])},String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t};var i,s,o,p,c={stopInterval:!1,initYoutubeControls:function(){n.mobilecheck()&&!window.MSStream&&$("#controls").appendTo("#playbar"),c.initControls()},initControls:function(){document.getElementById("volume-button").addEventListener("click",c.mute_video),document.getElementById("playpause").addEventListener("click",c.play_pause),document.getElementById("volume-button-overlay").addEventListener("click",c.mute_video),document.getElementById("playpause-overlay").addEventListener("click",c.play_pause),document.getElementById("fullscreen").addEventListener("click",c.fullscreen)},initSlider:function(){try{w=Crypt.get_volume()}catch(e){}$("#volume").slider({min:0,max:100,value:w,range:"min",animate:!0,slide:function(e,t){c.setVolume(t.value);try{Crypt.set_volume(t.value)}catch(e){}}}),c.choose_button(w,!1)},fullscreen:function(){var e=document.getElementById("player"),t=e.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen;t&&t.bind(e)()},play_pause:function(){S?c.play_pause_show():1==l.player.getPlayerState()?(l.pauseVideo(),n.mobilecheck()&&!window.MSStream&&(document.getElementById("player").style.display="none",$(".video-container").toggleClass("click-through"),$(".page-footer").toggleClass("padding-bottom-extra"))):(2==l.player.getPlayerState()||0===l.player.getPlayerState()||5===l.player.getPlayerState()&&n.mobilecheck())&&(l.playVideo(),n.mobilecheck()&&!window.MSStream&&(document.getElementById("player").style.display="block",$(".video-container").toggleClass("click-through"),$(".page-footer").toggleClass("padding-bottom-extra")))},play_pause_show:function(){S?$("#play").hasClass("hide")?l.pauseVideo():$("#pause").hasClass("hide")&&l.playVideo():(1==document.getElementById("pause").className.split(" ").length&&($("#pause").toggleClass("hide"),$("#pause-overlay").toggleClass("hide")),2==document.getElementById("play").className.split(" ").length&&($("#play").toggleClass("hide"),$("#play-overlay").toggleClass("hide")))},settings:function(){$("#qS").toggleClass("hide")},changeQuality:function(e){l.player.getPlaybackQuality!=e&&(l.player.setPlaybackQuality(e),l.player.getPlaybackQuality()),$("#qS").toggleClass("hide")},mute_video:function(){l.player.isMuted()?(S&&castSession.sendMessage("urn:x-cast:zoff.no",{type:"unMute"}),l.player.unMute(),c.choose_button(l.player.getVolume(),!1)):(S&&castSession.sendMessage("urn:x-cast:zoff.no",{type:"mute"}),c.choose_button(0,!0),l.player.mute())},setVolume:function(e){l.setVolume(e),c.choose_button(e,!1),l.player.isMuted()&&l.player.unMute()},choose_button:function(e,t){t?(1==document.getElementById("v-full").className.split(" ").length&&($("#v-full").toggleClass("hide"),$("#v-full-overlay").toggleClass("hide")),1==document.getElementById("v-medium").className.split(" ").length&&($("#v-medium").toggleClass("hide"),$("#v-medium-overlay").toggleClass("hide")),1==document.getElementById("v-low").className.split(" ").length&&($("#v-low").toggleClass("hide"),$("#v-low-overlay").toggleClass("hide")),2==document.getElementById("v-mute").className.split(" ").length&&($("#v-mute").toggleClass("hide"),$("#v-mute-overlay").toggleClass("hide"))):e>=0&&e<=33?(1==document.getElementById("v-full").className.split(" ").length&&($("#v-full").toggleClass("hide"),$("#v-full-overlay").toggleClass("hide")),1==document.getElementById("v-medium").className.split(" ").length&&($("#v-medium").toggleClass("hide"),$("#v-medium-overlay").toggleClass("hide")),2==document.getElementById("v-low").className.split(" ").length&&($("#v-low").toggleClass("hide"),$("#v-low-overlay").toggleClass("hide")),1==document.getElementById("v-mute").className.split(" ").length&&($("#v-mute").toggleClass("hide"),$("#v-mute-overlay").toggleClass("hide"))):e>=34&&e<=66?(1==document.getElementById("v-full").className.split(" ").length&&($("#v-full").toggleClass("hide"),$("#v-full-overlay").toggleClass("hide")),2==document.getElementById("v-medium").className.split(" ").length&&($("#v-medium").toggleClass("hide"),$("#v-medium-overlay").toggleClass("hide")),1==document.getElementById("v-low").className.split(" ").length&&($("#v-low").toggleClass("hide"),$("#v-low-overlay").toggleClass("hide")),1==document.getElementById("v-mute").className.split(" ").length&&($("#v-mute").toggleClass("hide"),$("#v-mute-overlay").toggleClass("hide"))):e>=67&&e<=100&&(2==document.getElementById("v-full").className.split(" ").length&&($("#v-full").toggleClass("hide"),$("#v-full-overlay").toggleClass("hide")),1==document.getElementById("v-medium").className.split(" ").length&&($("#v-medium").toggleClass("hide"),$("#v-medium-overlay").toggleClass("hide")),1==document.getElementById("v-low").className.split(" ").length&&($("#v-low").toggleClass("hide"),$("#v-low-overlay").toggleClass("hide")),1==document.getElementById("v-mute").className.split(" ").length&&($("#v-mute").toggleClass("hide"),$("#v-mute-overlay").toggleClass("hide")))},playPause:function(){state=l.player.getPlayerState(),button=document.getElementById("playpause"),1==state?l.pauseVideo():2==state&&l.playVideo()},volumeOptions:function(){S||(l.player.isMuted()?(l.player.unMute(),w=l.player.getVolume(),$("#volume").slider("value",l.player.getVolume())):(l.player.mute(),$("#volume").slider("value",0)))},hoverMute:function(e){w=l.player.getVolume()}},d={empty:!1,page:0,can_fit:Math.round($("#wrapper").height()/71),element_height:$("#wrapper").height()/Math.round($("#wrapper").height()/71)-25,uris:[],not_found:[],num_songs:0,channel_function:function(e){switch(e.type){case"list":d.populate_list(e.playlist),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id});break;case"added":d.added_song(e.value),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id});break;case"deleted":d.deleted_song(e.value);break;case"vote":d.voted_song(e.value,e.time),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id});break;case"song_change":"/"!=window.location.pathname&&d.song_change(e.time),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id})}},insertAtBeginning:function(e,t){var a=0==d.page?"":"none",l=d.generateSong(e,t,!1,!0,!1,a,!1);$("#wrapper").append(l)},insertAtIndex:function(e,t,a){var l=d.getIndexOfSong(e.id),n="none";if(!e.now_playing){l>=d.page&&l<d.page+d.can_fit&&(n="block");var i=d.generateSong(e,t,!1,!0,!1,n,!1);0===l?$("#wrapper").prepend(i):$("#wrapper > div:nth-child("+l+")").after(i);var s=$("#wrapper").children()[l];$(s).css("display",n),"block"==n&&$("#wrapper").children().length>=d.page+d.can_fit+1?$($("#wrapper").children()[d.page+d.can_fit]).css("display","none"):l<d.page&&$("#wrapper").children().length-(d.page+1)>=0?$($("#wrapper").children()[d.page]).css("display","block"):$("#wrapper").children().length>d.page+d.can_fit&&$($("#wrapper").children()[d.page+d.can_fit-1]).css("display","block"),a&&d.page>0&&$($("#wrapper").children()[d.page-1]).css("display","none"),t&&setTimeout(function(){$(s).css("height",d.element_height)},5)}},populate_list:function(e){n.mobilecheck()||_?_?(d.can_fit=Math.round($("#wrapper").height()/91)+1,d.element_height=$("#wrapper").height()/d.can_fit-4):(d.can_fit=Math.round(($(window).height()-$(".tabs").height()-$("header").height()-66)/71)+1,d.element_height=($(window).height()-$(".tabs").height()-$("header").height()-66)/d.can_fit-6):(d.can_fit=Math.round($("#wrapper").height()/71)+1,d.element_height=$("#wrapper").height()/d.can_fit-6),void 0===f&&(f=$("#list-song-html").html()),full_playlist=e,d.sortList(),$("#wrapper").empty(),n.log("---------------------------"),n.log("---------FULL PLAYLIST-----"),n.log(full_playlist),n.log("---------------------------"),full_playlist.length>1?($.each(full_playlist,function(e,t){t.now_playing||$("#wrapper").append(d.generateSong(t,!1,v,!0,!1,"",!0))}),$("#wrapper").children().length>d.can_fit&&!$("#pageButtons").length?($('<div id="pageButtons"><span class="first_page_hide btn-flat">|<</span><a class="first_page waves-effect waves-light btn-flat">|<</a><span class="prev_page_hide btn-flat">< prev</span><a class="prev_page waves-effect waves-light btn-flat">< prev</a> <span id="pageNumber" class="btn-flat">1</span> <a class="last_page waves-effect waves-light btn-flat">>|</a><span class="last_page_hide btn-flat">>|</span><a class="next_page waves-effect waves-light btn-flat">next ></a><span class="next_page_hide btn-flat">next ></span></div>').insertAfter("#wrapper"),$(".prev_page").toggleClass("hide"),$(".first_page").toggleClass("hide"),$(".next_page_hide").css("display","none"),$(".last_page_hide").css("display","none")):$("#pageButtons").length||($('<div id="pageButtons"><span class="first_page_hide btn-flat">|<</span><a class="first_page waves-effect waves-light btn-flat">|<</a><span class="prev_page_hide btn-flat">< prev</span><a class="prev_page waves-effect waves-light btn-flat">< prev</a> <span id="pageNumber" class="btn-flat">1</span> <a class="last_page waves-effect waves-light btn-flat">>|</a><span class="last_page_hide btn-flat">>|</span><a class="next_page waves-effect waves-light btn-flat">next ></a><span class="next_page_hide btn-flat">next ></span></div>').insertAfter("#wrapper"),$(".prev_page").toggleClass("hide"),$(".next_page").toggleClass("hide"),$(".last_page").toggleClass("hide"),$(".first_page").toggleClass("hide"),$(".next_page_hide").css("display","inline-block"),$(".prev_page_hide").css("display","inline-block")),d.dynamicContentPage(-10)):(d.empty=!0,$("#wrapper").append("<span id='empty-channel-message'>The playlist is empty.</span>"),$("#pageButtons").length||($('<div id="pageButtons"><span class="first_page_hide btn-flat">|<</span><a class="first_page waves-effect waves-light btn-flat">|<</a><span class="prev_page_hide btn-flat">< prev</span><a class="prev_page waves-effect waves-light btn-flat">< prev</a> <span id="pageNumber" class="btn-flat">1</span> <a class="last_page waves-effect waves-light btn-flat">>|</a><span class="last_page_hide btn-flat">>|</span><a class="next_page waves-effect waves-light btn-flat">next ></a><span class="next_page_hide btn-flat">next ></span></div>').insertAfter("#wrapper"),$(".prev_page").toggleClass("hide"),$(".next_page").toggleClass("hide"),$(".last_page").toggleClass("hide"),$(".first_page").toggleClass("hide"),$(".next_page_hide").css("display","inline-block"),$(".prev_page_hide").css("display","inline-block"))),$("#settings").css("visibility","visible"),$("#settings").css("opacity","1"),$("#wrapper").css("opacity","1")},dynamicContentPageJumpTo:function(e){e*=d.can_fit,(e>d.page||e<d.page)&&($("#wrapper").children().slice(d.page,d.page+d.can_fit).hide(),d.page=e,$("#wrapper").children().slice(d.page,d.page+d.can_fit).show(),d.page>0&&$(".prev_page").hasClass("hide")&&($(".prev_page").toggleClass("hide"),$(".prev_page_hide").css("display","none"),$(".first_page").toggleClass("hide"),$(".first_page_hide").css("display","none")),d.page+d.can_fit>=$("#wrapper").children().length&&($(".next_page_hide").css("display","inline-block"),$(".next_page").css("display","none"),$(".last_page_hide").css("display","inline-block"),$(".last_page").css("display","none")),$("#pageNumber").html(d.page/d.can_fit+1))},dynamicContentPage:function(e){1==e?($("#wrapper").children().slice(d.page,d.page+d.can_fit).hide(),d.page=d.page+d.can_fit,$("#wrapper").children().slice(d.page,d.page+d.can_fit).show(),d.page>0&&$(".prev_page").hasClass("hide")&&($(".prev_page").toggleClass("hide"),$(".prev_page_hide").css("display","none"),$(".first_page").toggleClass("hide"),$(".first_page_hide").css("display","none")),d.page+d.can_fit>=$("#wrapper").children().length&&($(".next_page_hide").css("display","inline-block"),$(".next_page").css("display","none"),$(".last_page_hide").css("display","inline-block"),$(".last_page").css("display","none"))):10==e?($("#wrapper").children().slice(d.page,d.page+d.can_fit).hide(),d.page=Math.floor(($("#wrapper").children().length-1)/d.can_fit)*d.can_fit,$("#wrapper").children().slice(d.page,d.page+d.can_fit).show(),d.page>0&&$(".prev_page").hasClass("hide")&&($(".prev_page").toggleClass("hide"),$(".prev_page_hide").css("display","none"),$(".first_page").toggleClass("hide"),$(".first_page_hide").css("display","none")),d.page+d.can_fit>=$("#wrapper").children().length&&($(".next_page_hide").css("display","inline-block"),$(".next_page").css("display","none"),$(".last_page_hide").css("display","inline-block"),$(".last_page").css("display","none"))):e==-10?($("#wrapper").children().slice(d.page,d.page+d.can_fit).hide(),d.page=0,$("#wrapper").children().slice(d.page,d.page+d.can_fit).show(),0!=d.page||$(".prev_page").hasClass("hide")?$(".prev_page").hasClass("hide")?($(".prev_page_hide").css("display","inline-block"),$(".first_page_hide").css("display","inline-block")):($(".prev_page_hide").css("display","none"),$(".first_page_hide").css("display","none")):($(".prev_page").toggleClass("hide"),$(".prev_page_hide").css("display","inline-block"),$(".first_page").toggleClass("hide"),$(".first_page_hide").css("display","inline-block")),d.page+d.can_fit<$("#wrapper").children().length&&($(".next_page_hide").css("display","none"),$(".next_page").css("display","inline-block"),$(".last_page_hide").css("display","none"),$(".last_page").css("display","inline-block"))):($("#wrapper").children().slice(d.page-d.can_fit,d.page).show(),$("#wrapper").children().slice(d.page,d.page+d.can_fit).hide(),d.page=d.page-d.can_fit,0!=d.page||$(".prev_page").hasClass("hide")?$(".prev_page").hasClass("hide")?($(".prev_page_hide").css("display","inline-block"),$(".first_page_hide").css("display","inline-block")):($(".prev_page_hide").css("display","none"),$(".first_page_hide").css("display","none")):($(".prev_page").toggleClass("hide"),$(".prev_page_hide").css("display","inline-block"),$(".first_page").toggleClass("hide"),$(".first_page_hide").css("display","inline-block")),d.page+d.can_fit<$("#wrapper").children().length&&($(".next_page_hide").css("display","none"),$(".next_page").css("display","inline-block"),$(".last_page_hide").css("display","none"),$(".last_page").css("display","inline-block"))),$("#pageNumber").html(d.page/d.can_fit+1)},added_song:function(e){var t;0!==full_playlist.length&&(t=full_playlist.pop()),full_playlist.push(e),d.sortList(),t&&full_playlist.push(t),$("#suggested-"+e.id).remove(),d.empty&&(d.empty=!1),$("#empty-channel-message").remove(),d.insertAtIndex(e,!0),$("#wrapper").children().length>d.page+d.can_fit?($(".next_page_hide").css("display","none"),$(".next_page").removeClass("hide"),$(".next_page").css("display","inline-block")):($(".next_page_hide").css("display","inline-block"),$(".next_page").css("display","none"))},deleted_song:function(e){var t=d.getIndexOfSong(e),a=$("#wrapper").children()[t];try{a.style.height=0,setTimeout(function(){$("#"+e).remove(),full_playlist.splice(d.getIndexOfSong(e),1),t<d.page&&$("#wrapper").children().length-(d.page+1)>=0?$($("#wrapper").children()[d.page-1]).css("display","block"):$("#wrapper").children().length>d.page+(d.can_fit-1)&&$($("#wrapper").children()[d.page+(d.can_fit-1)]).css("display","block"),d.page>=$("#wrapper").children().length?d.dynamicContentPage(-1):d.page+d.can_fit>=$("#wrapper").children().length&&($(".next_page_hide").css("display","inline-block"),$(".next_page").css("display","none")),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id})},305)}catch(a){full_playlist.splice(d.getIndexOfSong(e),1),d.empty||($("#wrapper").children()[$("#wrapper").children().length-1].remove(),t<d.page&&$("#wrapper").children().length-(d.page+1)>=0?$($("#wrapper").children()[d.page-1]).css("display","block"):$("#wrapper").children().length>d.page+d.can_fit&&$($("#wrapper").children()[d.page+(d.can_fit-1)]).css("display","block"),S&&l.sendNext({title:full_playlist[0].title,videoId:full_playlist[0].id}))}full_playlist.length<=2&&(d.empty=!0,$("#wrapper").append("<span id='empty-channel-message'>The playlist is empty.</span>")),$("#suggested-"+e).remove(),d.page+d.can_fit<$("#wrapper").children().length&&($(".next_page_hide").css("display","none"),$(".next_page").css("display","inline-block")),d.page>=$("#wrapper").children().length&&d.dynamicContentPage(-1),Suggestions.checkUserEmpty()},voted_song:function(e,t){var a=d.getIndexOfSong(e),l=full_playlist[a];full_playlist[a].votes+=1,full_playlist[a].added=t,d.sortList(),$("#"+e).remove(),d.insertAtIndex(l,!1)},song_change:function(e){var t=full_playlist.length-1;full_playlist[0].now_playing=!0,full_playlist[0].votes=0,full_playlist[0].guids=[],full_playlist[0].added=e,full_playlist[t].now_playing=!1,n.log("---------------------------"),n.log("---SONG ON FIRST INDEX-----"),n.log(full_playlist[0]),n.log("---------------------------");try{full_playlist.push(full_playlist.shift()),d.empty||$("#wrapper").children()[0].remove(),0===$("#wrapper").children().length&&(d.empty=!0,$("#wrapper").append("<span id='empty-channel-message'>The playlist is empty.</span>")),d.insertAtIndex(full_playlist[t-1],!1,!0)}catch(e){}},vote:function(e,t){return s.emit("vote",{channel:I,id:e,type:t,adminpass:C}),!0},skip:function(){return s.emit("skip",{pass:C,id:o,channel:I.toLowerCase()}),!0},exportToSpotify:function(){$.ajax({type:"GET",url:"https://api.spotify.com/v1/me",headers:{Authorization:"Bearer "+access_token_data.access_token},success:function(e){var t=e.id;$("#playlist_loader_export").removeClass("hide"),$(".exported-list-container").removeClass("hide"),$.ajax({type:"POST",url:"https://api.spotify.com/v1/users/"+t+"/playlists",headers:{Authorization:"Bearer "+access_token_data.access_token,"Content-Type":"application/json"},data:JSON.stringify({name:I.toLowerCase()+" - Zöff",public:!0}),success:function(e){var a=e.id;$.each(full_playlist,function(e,l){d.searchSpotify(l,a,t)})}})}})},searchSpotify:function(e,t,a){var l=e.title,i=e.title.toLowerCase().replace("-"," ");i=i.replace("official hd video",""),i=i.replace("unofficial video",""),i=i.replace("studio footage",""),i=i.replace("great song",""),i=i.replace("-"," "),i=i.replace("-"," "),i=i.replace(" hq "," "),i=i.replace("lyric video",""),i=i.replace("lyrics video",""),i=i.replace("album version",""),i=i.replace("drive original movie soundtrack",""),i=i.replace("original movie soundtrack",""),i=i.replace("live sessions",""),i=i.replace("audio only",""),i=i.replace("audio",""),i=i.replace("(new)",""),i=i.replace(" by "," "),i=i.replace(" vs "," "),i=i.replace("(full)"," "),i=i.replace("with lyrics",""),
i=i.replace("lyrics",""),i=i.replace("w/",""),i=i.replace("w/",""),i=i.replace("official video",""),i=i.replace("studio version",""),i=i.replace("official music video",""),i=i.replace("music video",""),i=i.replace("musicvideo",""),i=i.replace("original video",""),i=i.replace("full version",""),i=i.replace("full song",""),i=i.replace("(official)",""),i=i.replace("official",""),i=i.replace("(original)",""),i=i.replace("("," "),i=i.replace(")"," "),i=i.replace("feat."," "),i=i.replace("feat"," "),i=i.replace("ft."," "),i=i.replace("["," "),i=i.replace("]"," "),i=i.replace(" free ",""),i=i.replace(" hd ",""),i=i.replace("original mix"," "),i=i.replace("radio edit"," "),i=i.replace("pop version"," "),i=i.replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," "),i=encodeURIComponent(i),$.ajax({type:"GET",url:"https://api.spotify.com/v1/search?q="+i+"&type=track",headers:{Authorization:"Bearer "+access_token_data.access_token},async:!0,error:function(t){if(429==t.status){var a=t.getResponseHeader("Retry-After");a=parseInt(a,10),n.log("Retry-After",a),setTimeout(function(){d.searchSpotify(e)},1e3*a)}},success:function(e){var s=!1;if($.each(e.tracks.items,function(e,t){if(t.name=t.name.toLowerCase(),t.name=t.name.replace("("," "),t.name=t.name.replace(")"," "),t.name=t.name.replace("["," "),t.name=t.name.replace("]"," "),t.name=t.name.replace("-"," "),t.name=t.name.replace("-"," "),t.name=t.name.replace("-"," "),t.name=t.name.replace("original mix"," "),t.name=t.name.replace("album version"," "),t.name=t.name.replace("abum version"," "),t.name=t.name.replace("feat."," "),t.artists[0].name=t.artists[0].name.replace("feat."," "),t.artists[0].name=t.artists[0].name.replace("feat"," "),t.name=t.name.replace("feat"," "),t.name=t.name.replace("ft."," "),t.name=t.name.replace("radio edit"," "),t.name=t.name.replace("pop version"," "),t.name=t.name.replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," "),t.artists[0].name=t.artists[0].name.replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ").replace("  "," ")," "==t.name.substring(t.name.length-1)&&(t.name=t.name.substring(0,t.name.length-1)),"."==t.name.substring(t.name.length-1)&&"."!=i.substring(i.length-1)&&(t.name=t.name.substring(0,t.name.length-1)),decodeURIComponent(i).indexOf(t.artists[0].name.toLowerCase())>=0&&decodeURIComponent(i).indexOf(t.name.toLowerCase())>=0)return s=!0,d.uris.push(t.uri),n.log("Found",i),!1;for(var a=t.name.split(" "),e=0;e<a.length;e++)if(!("and"==a[e]&&i.indexOf("&")>=0||"&"==a[e]&&i.indexOf("and")>=0)&&i.indexOf(a[e])<0)return!0;return s=!0,d.uris.push(t.uri),n.log("Found",i),!1}),s||(d.not_found.push(l),d.num_songs=d.num_songs+1,n.log("Didn't find",l)),d.num_songs+d.uris.length==full_playlist.length){if(d.uris.length>100){for(;d.uris.length>100;)d.addToSpotifyPlaylist(d.uris.slice(0,100),t,a),d.uris.length>200?d.uris=d.uris.slice(100,200):d.uris=d.uris.slice(100,d.uris.length);d.addToSpotifyPlaylist(d.uris,t,a),$("#playlist_loader_export").addClass("hide")}else d.addToSpotifyPlaylist(d.uris,t,a),$("#playlist_loader_export").addClass("hide");$(".exported-list").append("<a target='_blank' class='btn light exported-playlist' href='https://open.spotify.com/user/"+a+"/playlist/"+t+"'>"+I+"</a>"),$.each(d.not_found,function(e,t){var a=$("<div>"+not_export_html+"</div>");a.find(".extra-add-text").attr("value",t),a.find(".extra-add-text").attr("title",t),$(".not-exported-container").append(a.html())}),$(".not-exported").removeClass("hide")}}})},addToSpotifyPlaylist:function(e,t,a){$.ajax({type:"POST",url:"https://api.spotify.com/v1/users/"+a+"/playlists/"+t+"/tracks",headers:{Authorization:"Bearer "+access_token_data.access_token,"Content-Type":"application/json"},data:JSON.stringify({uris:e}),success:function(e){n.log("Added songs")}})},exportToYoutube:function(){var e="https://www.googleapis.com/youtube/v3/playlists?part=snippet";$(".exported-list-container").removeClass("hide"),$("#playlist_loader_export").removeClass("hide"),$.ajax({type:"POST",url:e,headers:{Authorization:"Bearer "+access_token_data_youtube.access_token,"Content-Type":"application/json"},data:JSON.stringify({snippet:{title:I.toLowerCase(),description:"Playlist exported from zoff"}}),success:function(e){var t=0,a=e.id;$.each(full_playlist,function(e,l){var i="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet";$.ajax({type:"POST",url:i,headers:{Authorization:"Bearer "+access_token_data_youtube.access_token,"Content-Type":"application/json"},data:JSON.stringify({snippet:{playlistId:a,resourceId:{kind:"youtube#video",videoId:l.id}}}),error:function(e){t==full_playlist.length-1&&(n.log("All videoes added!"),n.log("url: https://www.youtube.com/playlist?list="+a),$(".exported-list").append("<h5>Exported list</h5>"),$(".exported-list").append("<a target='_blank' class='btn light exported-playlist' href='https://www.youtube.com/playlist?list="+a+"'>"+I+"</a>"),$("#playlist_loader_export").addClass("hide")),t+=1},success:function(e){n.log("Added video: "+l.id+" to playlist id "+a),t==full_playlist.length-1&&(n.log("All videoes added!"),n.log("url: https://www.youtube.com/playlist?list="+a),$(".exported-list").append("<a target='_blank' class='btn light exported-playlist' href='https://www.youtube.com/playlist?list="+a+"'>"+I+"</a>"),$("#playlist_loader_export").addClass("hide")),t+=1}})})},error:function(e){n.log(e)}})},importOldList:function(e){var t="",a=0;playlist_url="lists/"+e+".json",list=$.parseJSON($.ajax({type:"GET",url:playlist_url,async:!1}).responseText),$.each(list.songs,function(e,l){t+=l.id+",",a>45&&(Search.addVideos(t),t="",a=0),a++}),Search.addVideos(t),document.getElementById("search").value=""},sortList:function(){full_playlist.sort(n.predicate({name:"votes",reverse:!0},{name:"added",reverse:!1},{name:"title",reverse:!1}))},show:function(){n.mobilecheck()||(showToggle?(showToggle=!1,$("#toptitle").empty(),$("#chan").addClass("bigChan"),$("#chan").html("zoff.no/"+I.toLowerCase())):(showToggle=!0,$("#toptitle").html("Zöff"),$("#chan").removeClass("bigChan"),$("#chan").html(I)))},generateSong:function(e,t,a,l,n,i,s){void 0===f&&(f=$("#list-song-html").html());var o,r,p=e.id,c=e.title,g=e.votes,u="background-image:url('//img.youtube.com/vi/"+p+"/mqdefault.jpg');",h=$("<div>"+f+"</div>"),m="style";return t?h.find("#list-song").css("height",0):h.find(".list-song").css("height",d.element_height),y||h.find(".card-action").removeClass("hide"),1==g&&h.find(".vote-text").text("vote"),a&&(u="//img.youtube.com/vi/"+p+"/mqdefault.jpg",m="data-original"),l?(h.find(".list-votes").text(g),h.find("#list-song").attr("id",p),h.find(".vote-container").attr("title",c),($("#wrapper").children().length>=d.can_fit&&s||"none"==i)&&h.find(".card").css("display","none"),o=".vote-container",r="del"):l||(h.find(".vote-text").text(e.duration),o=".add-suggested",r=n?"del_user_suggested":"del_suggested",h.find(".vote-container").attr("class","clickable add-suggested"),h.find(".add-suggested").attr("title",c),h.find("#del").attr("id",r),h.find(o).attr("data-video-title",c),h.find(o).attr("data-video-length",e.length),h.find("#list-song").attr("id","suggested-"+p),h.find(".list-image").attr("class",h.find(".list-image").attr("class").replace("list-image","list-suggested-image"))),h.find(".list-title").text(c),h.find(".list-title").attr("title",c),h.find(o).attr("data-video-id",p),h.find(".list-image").attr(m,u),h.find(".list-suggested-image").attr(m,u),h.find("#"+r).attr("data-video-id",p),h.html()},getIndexOfSong:function(e){return indexes=$.map(full_playlist,function(t,a){if(t.id==e)return a}),indexes[0]},scrollTop:function(){$("#wrapper").scrollTop(0)},scrollBottom:function(){$("#wrapper").scrollTop($("#wrapper")[0].scrollHeight)}},u="",h=!1,m=!1,f=$("#list-song-html").html(),y=!0,v=!1,_=!0,w=100,C="",k=!1,x=!1,S=!1,T=window.location.hash.substring(1).split("&"),I=T[0],B=!1,E="#808080",M={"sync disconnect on unload":!0,secure:!0,"force new connection":!0};$(document).ready(function(){3==T.length&&"autoplay"==T[2]?B=!0:h=!0,E="#"+T[1],$("head").append('<link type="text/css" rel="stylesheet" href="/public/css/embed.css" />'),$("head").append('<link type="text/css" rel="stylesheet" href="/public/css/materialize.min.css" />'),add="https://zoff.no",s=io.connect(""+add+":8080",M),s.on("get_list",function(){setTimeout(function(){s.emit("list",I.toLowerCase())},1e3)}),s.on("viewers",function(e){viewers=e,void 0!==u&&l.getTitle(u,viewers)}),e(),t(),window.onYouTubeIframeAPIReady=l.onYouTubeIframeAPIReady,l.loadPlayer(),c.initSlider(),window.setVolume=a,$("#controls").css("background-color",E),$("#playlist").css("background-color",E)}),$(document).on("click","#zoffbutton",function(e){window.open("https://zoff.no/"+I.toLowerCase()+"/","_blank")}),$(document).on("click",".vote-container",function(e){var t=$(this).attr("data-video-id");d.vote(t,"pos")}),$(document).on("click",".prev_page",function(e){e.preventDefault(),d.dynamicContentPage(-1)}),$(document).on("click",".next_page",function(e){e.preventDefault(),d.dynamicContentPage(1)})}();